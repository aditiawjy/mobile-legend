"use strict";(()=>{var e={};e.id=2180,e.ids=[2180],e.modules={2418:e=>{e.exports=require("mysql2/promise")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8281:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>p});var a={};r.r(a),r.d(a,{default:()=>u});var i=r(1802),n=r(7153),o=r(6249),s=r(1004);async function u(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r="true"===e.query.fetchAll?1e4:parseInt(e.query.limit)||20,a=parseInt(e.query.offset)||0,i="string"==typeof e.query.category?e.query.category.trim():"",n=e.query.sortBy||"name",o="desc"===e.query.sortOrder?"DESC":"ASC",u=e.query.minPrice?parseInt(e.query.minPrice):null,l=e.query.maxPrice?parseInt(e.query.maxPrice):null,c=[],p=[];i&&(c.push("category = ?"),p.push(i)),null!==u&&(c.push("price >= ?"),p.push(u)),null!==l&&(c.push("price <= ?"),p.push(l));let m=c.length>0?`WHERE ${c.join(" AND ")}`:"",d="ORDER BY ";"price"===n?d+=`price ${o}, item_name ASC`:d+=`item_name ${o}`;let f=`SELECT COUNT(*) as total FROM items ${m}`,y=await (0,s.I)(f,p),P=y[0]?.total||0,h=`
      SELECT * 
      FROM items 
      ${m}
      ${d}
      LIMIT ? OFFSET ?
    `,A=await (0,s.I)(h,[...p,r,a]);t.status(200).json({items:A,total:P,limit:r,offset:a,hasMore:a+A.length<P,filters:{category:i,sortBy:n,sortOrder:o,minPrice:u,maxPrice:l}})}catch(e){console.error("Error fetching all items:",e),t.status(200).json({items:[],total:0,limit:20,offset:0,hasMore:!1})}}let l=(0,o.l)(a,"default"),c=(0,o.l)(a,"config"),p=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/items",pathname:"/api/items",bundlePath:"",filename:""},userland:a})},1004:(e,t,r)=>{let a;r.d(t,{I:()=>s,db:()=>o});var i=r(2418),n=r.n(i);async function o(){if(!a){let{DB_HOST:e="localhost",DB_NAME:t="",DB_USER:r="",DB_PASS:i="",DB_PORT:o="3306"}=process.env;try{a=n().createPool({host:e,port:Number(o),user:r,password:i,database:t,connectionLimit:10,charset:"utf8mb4_unicode_ci",acquireTimeout:6e4,timeout:6e4,enableKeepAlive:!0,keepAliveInitialDelay:0})}catch(e){throw console.error("Failed to create database pool:",e),Error("Database connection failed")}}return a}async function s(e,t=[]){try{let r=await o(),[a]=await r.execute(e,t);return a}catch(e){throw console.error("Database query failed:",e),e}}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=8281);module.exports=r})();