(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[645],{3466:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/edit-items",function(){return a(180)}])},180:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var r=a(5893),n=a(7294),s=a(1163);let l=[{key:"category",label:"Category"},{key:"price",label:"Price"},{key:"description",label:"Description",textarea:!0},{key:"image_url",label:"Image URL",placeholder:"https://example.com/image.png"}];function i(){let e=(0,s.useRouter)(),t="string"==typeof e.query.name?e.query.name:"",[a,i]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!1),[m,d]=(0,n.useState)(""),[u,h]=(0,n.useState)(""),[p,b]=(0,n.useState)(()=>Object.fromEntries(l.map(e=>[e.key,""]))),x=(0,n.useMemo)(()=>!!p&&l.some(e=>{let t=p[e.key];return t&&""!==t.toString().trim()}),[p]),[y,f]=(0,n.useState)(""),[g,k]=(0,n.useState)([]),[w,j]=(0,n.useState)(-1),[v,N]=(0,n.useState)(!1),E=(0,n.useRef)(null),S=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!t){b(Object.fromEntries(l.map(e=>[e.key,""])));return}f(t),N(!1),i(!0),d(""),h(""),fetch("/api/items/".concat(encodeURIComponent(t))).then(async e=>{if(404===e.status)return{...Object.fromEntries(l.map(e=>[e.key,""])),item_name:t};if(!e.ok){let t=await e.text().catch(()=>"");throw Error("Gagal memuat (".concat(e.status,") ").concat(t))}return{...await e.json(),item_name:t}}).then(e=>{b({...Object.fromEntries(l.map(e=>[e.key,""])),...e})}).catch(e=>d(e.message||"Error")).finally(()=>i(!1))},[t]);let[_,C]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=setTimeout(()=>C(y),300);return()=>clearTimeout(e)},[y]),(0,n.useEffect)(()=>{let e=!1;return(async()=>{let t=_.trim();if(!t||!v){k([]),j(-1);return}try{let a=await fetch("/api/items_search?q=".concat(encodeURIComponent(t)));if(!a.ok)throw Error("Network error");let r=await a.json();e||k(Array.isArray(r)?r:[])}catch(e){console.error(e)}})(),()=>{e=!0}},[_,v]);let D=t=>{k([]),j(-1),e.push({pathname:"/edit-items",query:{name:t}},void 0,{shallow:!1})};(0,n.useEffect)(()=>{let e=e=>{E.current&&!E.current.contains(e.target)&&e.target!==S.current&&k([])};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);let I=(e,t)=>{b(a=>({...a,[e]:t}))},P=async e=>{if(e.preventDefault(),t){c(!0),d(""),h("");try{let e={};if(l.forEach(t=>{let a=p[t.key];void 0!==a&&(e[t.key]=a)}),!(await fetch("/api/items/".concat(encodeURIComponent(t)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Gagal menyimpan perubahan");h("Perubahan berhasil disimpan"),b(a=>({...a,...e,item_name:t}))}catch(e){d(e.message||"Error")}finally{c(!1)}}};return(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50",children:(0,r.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[(0,r.jsxs)("header",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Edit Items"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("a",{href:"/items",className:"text-sm inline-flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 text-gray-700 bg-white hover:bg-gray-100",children:"Items"}),(0,r.jsx)("a",{href:"/edit-matches",className:"text-sm inline-flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 text-gray-700 bg-white hover:bg-gray-100",children:"Matches"}),(0,r.jsx)("a",{href:"/",className:"text-sm inline-flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 text-gray-700 bg-white hover:bg-gray-100",children:"Home"})]})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow border border-gray-100 p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pilih Item"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{id:"itemInput",ref:S,value:y,onChange:e=>{f(e.target.value),j(-1),N(!0)},onKeyDown:e=>{if(g.length)switch(e.key){case"ArrowDown":e.preventDefault(),j(e=>(e+1)%g.length);break;case"ArrowUp":e.preventDefault(),j(e=>(e-1+g.length)%g.length);break;case"Enter":w>=0&&(e.preventDefault(),D(g[w]));break;case"Escape":k([])}},placeholder:"Ketik nama item...",className:"w-full rounded-md border border-gray-300 bg-white focus:border-black focus:ring-black px-3 py-2",autoComplete:"off"}),g.length>0&&(0,r.jsx)("div",{ref:E,className:"absolute z-10 mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-lg max-h-72 overflow-auto",children:g.map((e,t)=>(0,r.jsx)("div",{className:"cursor-pointer px-4 py-2 text-sm text-gray-700 ".concat(0===t?"rounded-t-xl":""," ").concat(t===g.length-1?"rounded-b-xl":""," ").concat(t===w?"bg-gray-100":""),onMouseDown:t=>{t.preventDefault(),D(e)},children:e},e+t))})]}),t&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Sedang mengedit item: ",(0,r.jsx)("span",{className:"font-medium",children:t})]})]}),a&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Memuat data..."}),m&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:m}),u&&(0,r.jsx)("p",{className:"text-sm text-green-600",children:u}),!a&&!m&&t&&!x&&(0,r.jsx)("div",{className:"mt-2 rounded-md bg-yellow-50 border border-yellow-200 text-yellow-800 text-sm px-3 py-2",children:'Data item ini belum ada di database. Silakan isi form di bawah lalu klik "Simpan Perubahan".'}),(0,r.jsxs)("form",{onSubmit:P,className:"mt-4 space-y-4",children:[l.map(e=>{let t=p&&void 0!==p[e.key]&&null!==p[e.key]?p[e.key]:"";return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e.label}),e.textarea?(0,r.jsx)("textarea",{value:t,onChange:t=>I(e.key,t.target.value),className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black",rows:4,placeholder:"Masukkan ".concat(e.label.toLowerCase(),"...")}):(0,r.jsx)("input",{type:"price"===e.key?"number":"text",value:t,onChange:t=>I(e.key,t.target.value),className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black",placeholder:e.placeholder||"Masukkan ".concat(e.label.toLowerCase(),"...")})]},e.key)}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)("button",{type:"submit",disabled:o,className:"inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:o?"Menyimpan...":"Simpan Perubahan"})})]})]})]})})}},1163:function(e,t,a){e.exports=a(9090)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=3466)}),_N_E=e.O()}]);