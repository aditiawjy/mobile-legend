(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[589],{9588:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/edit-hero-adjustments",function(){return a(6742)}])},6742:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var r=a(5893),s=a(7294),n=a(1163);function d(){let e=(0,n.useRouter)(),t="string"==typeof e.query.name?e.query.name:"",[a,d]=(0,s.useState)(!1),[o,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(""),[m,u]=(0,s.useState)(""),[h,p]=(0,s.useState)([]),[x,g]=(0,s.useState)(null),[b,y]=(0,s.useState)({adj_date:"",season:"",description:""}),[f,j]=(0,s.useState)({adj_date:"",season:"",description:""}),[w,N]=(0,s.useState)(""),[v,k]=(0,s.useState)([]),[E,_]=(0,s.useState)(-1),[S,C]=(0,s.useState)(!1),A=(0,s.useRef)(null),T=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!t){p([]);return}N(t),C(!1),d(!0),c(""),u(""),fetch("/api/heroes/".concat(encodeURIComponent(t),"/adjustments")).then(async e=>{if(!e.ok)throw Error("Gagal memuat data");return e.json()}).then(e=>p(Array.isArray(e)?e:[])).catch(e=>c(e.message||"Error")).finally(()=>d(!1))},[t]);let[D,R]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=setTimeout(()=>R(w),300);return()=>clearTimeout(e)},[w]),(0,s.useEffect)(()=>{let e=!1;return(async()=>{let t=D.trim();if(!t||!S){k([]),_(-1);return}try{let a=await fetch("/api/heroes_search?q=".concat(encodeURIComponent(t)));if(!a.ok)throw Error("Network error");let r=await a.json();e||k(Array.isArray(r)?r:[])}catch(e){console.error(e)}})(),()=>{e=!0}},[D,S]);let I=t=>{k([]),_(-1),e.push({pathname:"/edit-hero-adjustments",query:{name:t}},void 0,{shallow:!1})};(0,s.useEffect)(()=>{let e=e=>{A.current&&!A.current.contains(e.target)&&e.target!==T.current&&k([])};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);let U=(e,t)=>{j(a=>({...a,[e]:t}))},H=(e,t)=>{y(a=>({...a,[e]:t}))},O=async e=>{if(e.preventDefault(),t){i(!0),c(""),u("");try{let e={adj_date:f.adj_date,season:f.season,description:f.description};if(!e.description)throw Error("Deskripsi wajib diisi");if(!e.season)throw Error("Season wajib diisi");if(!(await fetch("/api/heroes/".concat(encodeURIComponent(t),"/adjustments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Gagal menyimpan perubahan");u("Adjustment berhasil ditambahkan"),j({adj_date:"",season:"",description:""});let a=await fetch("/api/heroes/".concat(encodeURIComponent(t),"/adjustments"));if(a.ok){let e=await a.json();p(Array.isArray(e)?e:[])}}catch(e){c(e.message||"Error")}finally{i(!1)}}};return(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50",children:(0,r.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[(0,r.jsxs)("header",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Edit Hero Adjustments"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("a",{href:"/",className:"text-sm inline-flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 text-gray-700 bg-white hover:bg-gray-100",children:"Heroes"}),(0,r.jsx)("a",{href:"/items",className:"text-sm inline-flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 text-gray-700 bg-white hover:bg-gray-100",children:"Items"}),(0,r.jsx)("a",{href:"/edit-matches",className:"text-sm inline-flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 text-gray-700 bg-white hover:bg-gray-100",children:"Matches"})]})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow border border-gray-100 p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pilih Hero"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{id:"heroAdjInput",ref:T,value:w,onChange:e=>{N(e.target.value),_(-1),C(!0)},onKeyDown:e=>{if(v.length)switch(e.key){case"ArrowDown":e.preventDefault(),_(e=>(e+1)%v.length);break;case"ArrowUp":e.preventDefault(),_(e=>(e-1+v.length)%v.length);break;case"Enter":E>=0&&(e.preventDefault(),I(v[E]));break;case"Escape":k([])}},placeholder:"Ketik nama hero...",className:"w-full rounded-md border border-gray-300 bg-white focus:border-black focus:ring-black px-3 py-2",autoComplete:"off"}),v.length>0&&(0,r.jsx)("div",{ref:A,className:"absolute z-10 mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-lg max-h-72 overflow-auto",children:v.map((e,t)=>(0,r.jsx)("div",{className:"cursor-pointer px-4 py-2 text-sm text-gray-700 ".concat(0===t?"rounded-t-xl":""," ").concat(t===v.length-1?"rounded-b-xl":""," ").concat(t===E?"bg-gray-100":""),onMouseDown:t=>{t.preventDefault(),I(e)},children:e},e+t))})]}),t&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Sedang mengedit hero: ",(0,r.jsx)("span",{className:"font-medium",children:t})]})]}),a&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Memuat data..."}),l&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:l}),m&&(0,r.jsx)("p",{className:"text-sm text-green-600",children:m}),(0,r.jsxs)("form",{onSubmit:O,className:"mt-4 space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal"}),(0,r.jsx)("input",{type:"date",value:f.adj_date,onChange:e=>U("adj_date",e.target.value),className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Season"}),(0,r.jsx)("input",{type:"text",value:f.season,onChange:e=>U("season",e.target.value),placeholder:"e.g., Season 30",className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black"})]}),(0,r.jsxs)("div",{className:"md:col-span-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Deskripsi"}),(0,r.jsx)("textarea",{value:f.description,onChange:e=>U("description",e.target.value),rows:3,className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black",placeholder:"Tuliskan perubahan/penyesuaian skill di patch ..."})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:o||!t,className:"inline-flex items-center gap-2 px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50",children:o?"Menyimpan...":"Tambah Adjustment"})})]}),(0,r.jsxs)("div",{className:"mt-8",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Riwayat Adjustments"}),0===h.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Belum ada data."}):(0,r.jsx)("ul",{className:"mt-3 divide-y divide-gray-100",children:h.map(e=>{let a=x===e.id;return(0,r.jsx)("li",{className:"py-3",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex-1 min-w-0",children:a?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-600",children:"Tanggal"}),(0,r.jsx)("input",{type:"date",value:b.adj_date||"",onChange:e=>H("adj_date",e.target.value),className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-600",children:"Season"}),(0,r.jsx)("input",{type:"text",value:b.season||"",onChange:e=>H("season",e.target.value),placeholder:"e.g., Season 30",className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-600",children:"Deskripsi"}),(0,r.jsx)("textarea",{rows:3,value:b.description||"",onChange:e=>H("description",e.target.value),className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-black focus:ring-black"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[e.adj_date||"-"," â€¢ ",e.season||"-"]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mt-1 whitespace-pre-wrap",children:e.description})]})}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-2",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{type:"button",className:"text-xs px-2 py-1 rounded-md border border-gray-200 bg-white text-gray-700 hover:bg-gray-100",onClick:()=>{g(null),y({adj_date:"",season:"",description:""})},children:"Batal"}),(0,r.jsx)("button",{type:"button",className:"text-xs px-2 py-1 rounded-md bg-purple-600 text-white hover:bg-purple-700",onClick:async()=>{try{let a={adj_date:b.adj_date,season:b.season,description:b.description};if(!(await fetch("/api/heroes/".concat(encodeURIComponent(t),"/adjustments/").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw Error("Gagal menyimpan");p(t=>t.map(t=>t.id===e.id?{...t,...a}:t)),g(null),y({adj_date:"",season:"",description:""})}catch(e){alert(e.message||"Error")}},children:"Simpan"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{type:"button",className:"text-xs px-2 py-1 rounded-md border border-gray-200 bg-white text-gray-700 hover:bg-gray-100",onClick:()=>{g(e.id),y({adj_date:e.adj_date||"",season:e.season||"",description:e.description||""})},children:"Edit"}),(0,r.jsx)("button",{type:"button",className:"text-xs px-2 py-1 rounded-md border border-red-200 bg-white text-red-600 hover:bg-red-50",onClick:async()=>{if(confirm("Hapus adjustment ini?"))try{if(!(await fetch("/api/heroes/".concat(encodeURIComponent(hero),"/adjustments/").concat(e.id),{method:"DELETE"})).ok)throw Error("Gagal menghapus");p(t=>t.filter(t=>t.id!==e.id))}catch(e){alert(e.message||"Error")}},children:"Hapus"})]})})]})},e.id)})})]})]})]})})}},1163:function(e,t,a){e.exports=a(9090)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=9588)}),_N_E=e.O()}]);